(()=>{"use strict";var t={};function e(t,e){const i=t<e,s=t>=e*(e-1),l=t%e==0,n=(t+1)%e==0;return i&&l?"top-left":i&&n?"top-right":s&&l?"bottom-left":s&&n?"bottom-right":i?"top":s?"bottom":l?"left":n?"right":"center"}t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var i=t.g.document;if(!e&&i&&(i.currentScript&&(e=i.currentScript.src),!e)){var s=i.getElementsByTagName("script");s.length&&(e=s[s.length-1].src)}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})();class i{constructor(t){this.elemModal=null,this.eventShowModal=null,this.eventHideModal=null,this.hiding=!1,this.destroyed=!1,this.animationSpeed=200,this.options=t||{},this.createModal(),this.elemModal.addEventListener("click",this.handlerCloseModal.bind(this)),this.eventShowModal=new CustomEvent("show.modalFunc",{detail:this.elemModal}),this.eventHideModal=new CustomEvent("hide.modalFunc",{detail:this.elemModal})}createModal(){this.elemModal=document.createElement("div");let t,e="";if(this.elemModal.classList.add("modalFunc"),t='<div class="modal__backdrop" data-dismiss="modalFunc"><div class="modal__content"><div class="modal__header"><div class="modal__title" data-modalFunc="title">{{title}}</div><span class="modal__btn-close" data-dismiss="modalFunc" title="Закрыть">×</span></div><div class="modal__body" data-modalFunc="content">{{content}}</div>{{footer}}</div></div>'.replace("{{title}}",this.options.title||"Новое окно"),t=t.replace("{{content}}",this.options.content||""),this.options.footerButtons){for(const t of this.options.footerButtons){let i='<button type="button" class="{{button_class}}" data-handler={{button_handler}}>{{button_text}}</button>'.replace("{{button_class}}",t.class);i=i.replace("{{button_handler}}",t.handler),i=i.replace("{{button_text}}",t.text),e+=i}e='<div class="modal__footer">{{buttons}}</div>'.replace("{{buttons}}",e)}t=t.replace("{{footer}}",e),this.elemModal.innerHTML=t,document.body.appendChild(this.elemModal)}setupEventListeners(){this.elemModal.removeEventListener("click",this.handlerCloseModal),this.handlerCloseModalBound=this.handlerCloseModal.bind(this),this.elemModal.addEventListener("click",this.handlerCloseModalBound)}show(){this.destroyed||this.hiding||(this.elemModal.classList.add("modal__show"),document.dispatchEvent(this.eventShowModal))}hide(){this.hiding=!0,this.elemModal.classList.remove("modal__show"),this.elemModal.classList.add("modal__hiding"),setTimeout((()=>{this.elemModal.classList.remove("modal__hiding"),this.hiding=!1}),this.animationSpeed),document.dispatchEvent(this.eventHideModal)}handlerCloseModal(t){("modalFunc"===t.target.dataset.dismiss||t.target.dataset.handler)&&this.hide()}destroy(){this.elemModal.parentElement&&this.elemModal.parentElement.removeChild(this.elemModal),this.handlerCloseModalBound&&this.elemModal.removeEventListener("click",this.handlerCloseModalBound),this.destroyed=!0}setContent(t){this.elemModal.querySelector('[data-modalFunc="content"]').innerHTML=t}setTitle(t){this.elemModal.querySelector('[data-modalFunc="title"]').innerHTML=t}}let s=null;function l(t){const e=function(t){const e=t**2;return Array.from({length:e/8},((t,e)=>8*e)).flatMap((t=>[t,t+1]))}(t);let i;do{i=Math.floor(Math.random()*e.length)}while(e[i]===s);return s=e[i],s}const n={pointer:"pointer",notallowed:"not-allowed",hammer:`url('${t.p+"img/hammer_small.png"}'), not-allowed`};class o{constructor(t){this.hitCount=0,this.missCount=0,this.container=t,this.initUI()}initUI(){if(!(this.container instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container.insertAdjacentHTML("afterbegin",`\n    <div class="click-counter">\n        <div>Hit counts: <span class="hit-count">${this.getHitCount()}</span></div>\n        <div>Miss counts: <span class="miss-count">${this.getMissCount()}</span></div>\n    </div>\n    `),this.hitCountEl=this.container.querySelector(".hit-count"),this.missCountEl=this.container.querySelector(".miss-count")}incrementHit(){this.hitCount+=1,this.updateUI()}incrementMiss(){this.missCount+=1,this.updateUI()}updateUI(){this.hitCountEl.textContent=this.getHitCount(),this.missCountEl.textContent=this.getMissCount()}getHitCount(){return this.hitCount}getMissCount(){return this.missCount}reset(){this.missCount=0,this.hitCount=0,this.updateUI()}}console.log("it works!");const a=new class{constructor(t){this.boardSize=t,this.container=null,this.boardEl=null,this.cells=[],this.cellClickListeners=[],this.cellEnterListeners=[],this.cellLeaveListeners=[],this.isModal=!1,this.initModalListener()}bindToDOM(t){if(!(t instanceof HTMLElement))throw new Error("container is not HTMLElement");this.container=t}initModalListener(){document.addEventListener("click",(t=>{"modalHandlerCancel"===t.target.dataset.handler&&this.currentModal&&(this.currentModal.hide(),this.isModal=!1)}))}drawUi(t){this.checkBinding(),this.container.innerHTML='\n      <div class="board-container">\n        <div data-id="board" class="board"></div>\n      </div>\n    ',this.boardEl=this.container.querySelector("[data-id=board]"),this.boardEl.classList.add(t);for(let t=0;t<this.boardSize**2;t+=1){const i=document.createElement("div");i.classList.add("cell","map-tile",`map-tile-${e(t,this.boardSize)}`),i.addEventListener("mouseenter",(t=>this.onCellEnter(t))),i.addEventListener("mouseleave",(t=>this.onCellLeave(t))),i.addEventListener("click",(t=>this.onCellClick(t))),this.boardEl.appendChild(i)}this.cells=Array.from(this.boardEl.children)}redrawPositions(t){for(const t of this.cells)t.innerHTML="";if(void 0!==t&&t>=0&&t<this.cells.length){const e=this.boardEl.children[t],i=document.createElement("div");i.classList.add("character","generic"),e.appendChild(i)}}addCellEnterListener(t){this.cellEnterListeners.push(t)}addCellLeaveListener(t){this.cellLeaveListeners.push(t)}addCellClickListener(t){this.cellClickListeners.push(t)}onCellEnter(t){t.preventDefault();const e=this.cells.indexOf(t.currentTarget);this.cellEnterListeners.forEach((t=>t.call(null,e)))}onCellLeave(t){t.preventDefault();const e=this.cells.indexOf(t.currentTarget);this.cellLeaveListeners.forEach((t=>t.call(null,e)))}onCellClick(t){const e=this.cells.indexOf(t.currentTarget);this.cellClickListeners.forEach((t=>t.call(null,e)))}selectCell(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"yellow";this.deselectCell(t),this.cells[t].classList.add("selected",`selected-${e}`)}deselectCell(t){const e=this.cells[t];e.classList.remove(...Array.from(e.classList).filter((t=>t.startsWith("selected"))))}hideCellTooltip(t){this.cells[t].title=""}setCursor(t){this.boardEl.style.cursor=t}checkBinding(){if(null===this.container)throw new Error("GamePlay not bind to DOM")}showModalMessage(t,e){this.isModal||(this.isModal=!0,this.showModal(t,e))}showModal(t,e){const s=new i({title:t,content:`&#${e}`,footerButtons:[{class:"btn btn__cancel",text:"Close",handler:"modalHandlerCancel"}]});this.currentModal=s,s.show()}}(4);a.bindToDOM(document.querySelector("#game-container"));const r=new class{constructor(t){this.gamePlay=t,this.indexSelect=null,this.clickCounter=null,this.onCellClick=this.onCellClick.bind(this),this.onCellEnter=this.onCellEnter.bind(this),this.onCellLeave=this.onCellLeave.bind(this)}init(){this.events(),this.gamePlay.drawUi("prairie"),this.clickCounter=new o(document.querySelector("#game-container")),this.showCharacter()}events(){this.gamePlay.addCellEnterListener(this.onCellEnter),this.gamePlay.addCellLeaveListener(this.onCellLeave),this.gamePlay.addCellClickListener(this.onCellClick)}onCellClick(t){this.reactOnClick(t)}onCellEnter(t){this.gamePlay.setCursor(n.hammer),document.querySelector(".selected-generic")&&this.gamePlay.deselectCell(this.indexSelect),this.gamePlay.selectCell(t),this.indexSelect=t}onCellLeave(t){this.gamePlay.hideCellTooltip(t),this.gamePlay.setCursor(n.pointer)}showCharacter(){this.timerId=setInterval((()=>{const t=l(this.gamePlay.boardSize);this.gamePlay.redrawPositions(t)}),1e3),setTimeout((()=>this.resetTimer()),5e5)}resetTimer(){clearInterval(this.timerId)}reactOnClick(t){if(document.querySelectorAll(".cell")[t].querySelector(".generic")){this.clickCounter.incrementHit(),this.resetTimer(),this.showCharacter();const t=l(this.gamePlay.boardSize);this.gamePlay.redrawPositions(t),this.clickCounter.getHitCount()>=10&&(this.gamePlay.showModalMessage(`You win! Your points are ${this.clickCounter.getHitCount()}`,"127881"),this.reset())}else this.clickCounter.incrementMiss(),this.clickCounter.getMissCount()>=5&&(this.gamePlay.showModalMessage("You lose!","129335"),this.reset())}reset(){this.clickCounter.reset()}}(a);r.init()})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFTNUcsV0FDOUNPLEtBQUtxRyxTQUFTa0IsZ0JBQWdCQyxHQUUxQnhILEtBQUt1SixhQUFhN0QsZUFBaUIsS0FDckMxRixLQUFLcUcsU0FBUzJDLGlCQUFrQiw0QkFBMkJoSixLQUFLdUosYUFBYTdELGdCQUFpQixVQUM5RjFGLEtBQUtrRyxRQUVULE1BQ0VsRyxLQUFLdUosYUFBYXZELGdCQUNkaEcsS0FBS3VKLGFBQWE1RCxnQkFBa0IsSUFDdEMzRixLQUFLcUcsU0FBUzJDLGlCQUFpQixZQUFhLFVBQzVDaEosS0FBS2tHLFFBR1gsQ0FFQUEsUUFDRWxHLEtBQUt1SixhQUFhckQsT0FDcEIsR0Y5RWtDRyxHQUNwQ2dELEVBQVNHLE0iLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9haGotZXZlbnRzL3dlYnBhY2svYm9vdHN0cmFwIiwid2VicGFjazovL2Foai1ldmVudHMvLi9zcmMvanMvdXRpbHMvY2FsY1RpbGVUeXBlLmpzIiwid2VicGFjazovL2Foai1ldmVudHMvd2VicGFjay9ydW50aW1lL2dsb2JhbCIsIndlYnBhY2s6Ly9haGotZXZlbnRzL3dlYnBhY2svcnVudGltZS9wdWJsaWNQYXRoIiwid2VicGFjazovL2Foai1ldmVudHMvLi9zcmMvanMvY29tcG9uZW50cy9Nb2RhbC9Nb2RhbC5qcyIsIndlYnBhY2s6Ly9haGotZXZlbnRzLy4vc3JjL2pzL3V0aWxzL2NyZWF0ZVBvc2l0aW9uLmpzIiwid2VicGFjazovL2Foai1ldmVudHMvLi9zcmMvanMvY3Vyc29ycy5qcyIsIndlYnBhY2s6Ly9haGotZXZlbnRzLy4vc3JjL2pzL2NvbXBvbmVudHMvQ2xpY2tDb3VudGVyL0NsaWNrQ291bnRlci5qcyIsIndlYnBhY2s6Ly9haGotZXZlbnRzLy4vc3JjL2pzL2FwcC5qcyIsIndlYnBhY2s6Ly9haGotZXZlbnRzLy4vc3JjL2pzL2NvbXBvbmVudHMvR2FtZVBsYXkvR2FtZVBsYXkuanMiLCJ3ZWJwYWNrOi8vYWhqLWV2ZW50cy8uL3NyYy9qcy9jb21wb25lbnRzL0dhbWVDb250cm9sbGVyL0dhbWVDb250cm9sbGVyLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIi8vIFRoZSByZXF1aXJlIHNjb3BlXG52YXIgX193ZWJwYWNrX3JlcXVpcmVfXyA9IHt9O1xuXG4iLCJleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjYWxjVGlsZVR5cGUoaW5kZXgsIGJvYXJkU2l6ZSkge1xuICBjb25zdCBpc1RvcFJvdyA9IGluZGV4IDwgYm9hcmRTaXplO1xuICBjb25zdCBpc0JvdHRvbVJvdyA9IGluZGV4ID49IGJvYXJkU2l6ZSAqIChib2FyZFNpemUgLSAxKTtcbiAgY29uc3QgaXNMZWZ0Q29sdW1uID0gaW5kZXggJSBib2FyZFNpemUgPT09IDA7XG4gIGNvbnN0IGlzUmlnaHRDb2x1bW4gPSAoaW5kZXggKyAxKSAlIGJvYXJkU2l6ZSA9PT0gMDtcblxuICBpZiAoaXNUb3BSb3cgJiYgaXNMZWZ0Q29sdW1uKSByZXR1cm4gJ3RvcC1sZWZ0JztcbiAgaWYgKGlzVG9wUm93ICYmIGlzUmlnaHRDb2x1bW4pIHJldHVybiAndG9wLXJpZ2h0JztcbiAgaWYgKGlzQm90dG9tUm93ICYmIGlzTGVmdENvbHVtbikgcmV0dXJuICdib3R0b20tbGVmdCc7XG4gIGlmIChpc0JvdHRvbVJvdyAmJiBpc1JpZ2h0Q29sdW1uKSByZXR1cm4gJ2JvdHRvbS1yaWdodCc7XG4gIGlmIChpc1RvcFJvdykgcmV0dXJuICd0b3AnO1xuICBpZiAoaXNCb3R0b21Sb3cpIHJldHVybiAnYm90dG9tJztcbiAgaWYgKGlzTGVmdENvbHVtbikgcmV0dXJuICdsZWZ0JztcbiAgaWYgKGlzUmlnaHRDb2x1bW4pIHJldHVybiAncmlnaHQnO1xuICByZXR1cm4gJ2NlbnRlcic7XG59XG4iLCJfX3dlYnBhY2tfcmVxdWlyZV9fLmcgPSAoZnVuY3Rpb24oKSB7XG5cdGlmICh0eXBlb2YgZ2xvYmFsVGhpcyA9PT0gJ29iamVjdCcpIHJldHVybiBnbG9iYWxUaGlzO1xuXHR0cnkge1xuXHRcdHJldHVybiB0aGlzIHx8IG5ldyBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpO1xuXHR9IGNhdGNoIChlKSB7XG5cdFx0aWYgKHR5cGVvZiB3aW5kb3cgPT09ICdvYmplY3QnKSByZXR1cm4gd2luZG93O1xuXHR9XG59KSgpOyIsInZhciBzY3JpcHRVcmw7XG5pZiAoX193ZWJwYWNrX3JlcXVpcmVfXy5nLmltcG9ydFNjcmlwdHMpIHNjcmlwdFVybCA9IF9fd2VicGFja19yZXF1aXJlX18uZy5sb2NhdGlvbiArIFwiXCI7XG52YXIgZG9jdW1lbnQgPSBfX3dlYnBhY2tfcmVxdWlyZV9fLmcuZG9jdW1lbnQ7XG5pZiAoIXNjcmlwdFVybCAmJiBkb2N1bWVudCkge1xuXHRpZiAoZG9jdW1lbnQuY3VycmVudFNjcmlwdClcblx0XHRzY3JpcHRVcmwgPSBkb2N1bWVudC5jdXJyZW50U2NyaXB0LnNyYztcblx0aWYgKCFzY3JpcHRVcmwpIHtcblx0XHR2YXIgc2NyaXB0cyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpO1xuXHRcdGlmKHNjcmlwdHMubGVuZ3RoKSBzY3JpcHRVcmwgPSBzY3JpcHRzW3NjcmlwdHMubGVuZ3RoIC0gMV0uc3JjXG5cdH1cbn1cbi8vIFdoZW4gc3VwcG9ydGluZyBicm93c2VycyB3aGVyZSBhbiBhdXRvbWF0aWMgcHVibGljUGF0aCBpcyBub3Qgc3VwcG9ydGVkIHlvdSBtdXN0IHNwZWNpZnkgYW4gb3V0cHV0LnB1YmxpY1BhdGggbWFudWFsbHkgdmlhIGNvbmZpZ3VyYXRpb25cbi8vIG9yIHBhc3MgYW4gZW1wdHkgc3RyaW5nIChcIlwiKSBhbmQgc2V0IHRoZSBfX3dlYnBhY2tfcHVibGljX3BhdGhfXyB2YXJpYWJsZSBmcm9tIHlvdXIgY29kZSB0byB1c2UgeW91ciBvd24gbG9naWMuXG5pZiAoIXNjcmlwdFVybCkgdGhyb3cgbmV3IEVycm9yKFwiQXV0b21hdGljIHB1YmxpY1BhdGggaXMgbm90IHN1cHBvcnRlZCBpbiB0aGlzIGJyb3dzZXJcIik7XG5zY3JpcHRVcmwgPSBzY3JpcHRVcmwucmVwbGFjZSgvIy4qJC8sIFwiXCIpLnJlcGxhY2UoL1xcPy4qJC8sIFwiXCIpLnJlcGxhY2UoL1xcL1teXFwvXSskLywgXCIvXCIpO1xuX193ZWJwYWNrX3JlcXVpcmVfXy5wID0gc2NyaXB0VXJsOyIsImltcG9ydCAnLi9tb2RhbC5jc3MnO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBNb2RhbCB7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnMpIHtcbiAgICB0aGlzLmVsZW1Nb2RhbCA9IG51bGw7XG4gICAgdGhpcy5ldmVudFNob3dNb2RhbCA9IG51bGw7XG4gICAgdGhpcy5ldmVudEhpZGVNb2RhbCA9IG51bGw7XG4gICAgdGhpcy5oaWRpbmcgPSBmYWxzZTtcbiAgICB0aGlzLmRlc3Ryb3llZCA9IGZhbHNlO1xuICAgIHRoaXMuYW5pbWF0aW9uU3BlZWQgPSAyMDA7XG5cbiAgICB0aGlzLm9wdGlvbnMgPSBvcHRpb25zIHx8IHt9O1xuXG4gICAgdGhpcy5jcmVhdGVNb2RhbCgpO1xuICAgIHRoaXMuZWxlbU1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgdGhpcy5oYW5kbGVyQ2xvc2VNb2RhbC5iaW5kKHRoaXMpKTtcblxuICAgIHRoaXMuZXZlbnRTaG93TW9kYWwgPSBuZXcgQ3VzdG9tRXZlbnQoJ3Nob3cubW9kYWxGdW5jJywge1xuICAgICAgZGV0YWlsOiB0aGlzLmVsZW1Nb2RhbCxcbiAgICB9KTtcbiAgICB0aGlzLmV2ZW50SGlkZU1vZGFsID0gbmV3IEN1c3RvbUV2ZW50KCdoaWRlLm1vZGFsRnVuYycsIHtcbiAgICAgIGRldGFpbDogdGhpcy5lbGVtTW9kYWwsXG4gICAgfSk7XG4gIH1cblxuICBjcmVhdGVNb2RhbCgpIHtcbiAgICB0aGlzLmVsZW1Nb2RhbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNvbnN0IG1vZGFsVGVtcGxhdGUgPSAnPGRpdiBjbGFzcz1cIm1vZGFsX19iYWNrZHJvcFwiIGRhdGEtZGlzbWlzcz1cIm1vZGFsRnVuY1wiPjxkaXYgY2xhc3M9XCJtb2RhbF9fY29udGVudFwiPjxkaXYgY2xhc3M9XCJtb2RhbF9faGVhZGVyXCI+PGRpdiBjbGFzcz1cIm1vZGFsX190aXRsZVwiIGRhdGEtbW9kYWxGdW5jPVwidGl0bGVcIj57e3RpdGxlfX08L2Rpdj48c3BhbiBjbGFzcz1cIm1vZGFsX19idG4tY2xvc2VcIiBkYXRhLWRpc21pc3M9XCJtb2RhbEZ1bmNcIiB0aXRsZT1cItCX0LDQutGA0YvRgtGMXCI+w5c8L3NwYW4+PC9kaXY+PGRpdiBjbGFzcz1cIm1vZGFsX19ib2R5XCIgZGF0YS1tb2RhbEZ1bmM9XCJjb250ZW50XCI+e3tjb250ZW50fX08L2Rpdj57e2Zvb3Rlcn19PC9kaXY+PC9kaXY+JztcbiAgICBjb25zdCBtb2RhbEZvb3RlclRlbXBsYXRlID0gJzxkaXYgY2xhc3M9XCJtb2RhbF9fZm9vdGVyXCI+e3tidXR0b25zfX08L2Rpdj4nO1xuICAgIGNvbnN0IG1vZGFsQnV0dG9uVGVtcGxhdGUgPSAnPGJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY2xhc3M9XCJ7e2J1dHRvbl9jbGFzc319XCIgZGF0YS1oYW5kbGVyPXt7YnV0dG9uX2hhbmRsZXJ9fT57e2J1dHRvbl90ZXh0fX08L2J1dHRvbj4nO1xuICAgIGxldCBtb2RhbEhUTUw7XG4gICAgbGV0IG1vZGFsRm9vdGVySFRNTCA9ICcnO1xuXG4gICAgdGhpcy5lbGVtTW9kYWwuY2xhc3NMaXN0LmFkZCgnbW9kYWxGdW5jJyk7XG4gICAgbW9kYWxIVE1MID0gbW9kYWxUZW1wbGF0ZS5yZXBsYWNlKFxuICAgICAgJ3t7dGl0bGV9fScsXG4gICAgICB0aGlzLm9wdGlvbnMudGl0bGUgfHwgJ9Cd0L7QstC+0LUg0L7QutC90L4nLFxuICAgICk7XG4gICAgbW9kYWxIVE1MID0gbW9kYWxIVE1MLnJlcGxhY2UoJ3t7Y29udGVudH19JywgdGhpcy5vcHRpb25zLmNvbnRlbnQgfHwgJycpO1xuICAgIGlmICh0aGlzLm9wdGlvbnMuZm9vdGVyQnV0dG9ucykge1xuICAgICAgZm9yIChjb25zdCBidXR0b24gb2YgdGhpcy5vcHRpb25zLmZvb3RlckJ1dHRvbnMpIHtcbiAgICAgICAgbGV0IG1vZGFsRm9vdGVyQnV0dG9uID0gbW9kYWxCdXR0b25UZW1wbGF0ZS5yZXBsYWNlKFxuICAgICAgICAgICd7e2J1dHRvbl9jbGFzc319JyxcbiAgICAgICAgICBidXR0b24uY2xhc3MsXG4gICAgICAgICk7XG4gICAgICAgIG1vZGFsRm9vdGVyQnV0dG9uID0gbW9kYWxGb290ZXJCdXR0b24ucmVwbGFjZShcbiAgICAgICAgICAne3tidXR0b25faGFuZGxlcn19JyxcbiAgICAgICAgICBidXR0b24uaGFuZGxlcixcbiAgICAgICAgKTtcbiAgICAgICAgbW9kYWxGb290ZXJCdXR0b24gPSBtb2RhbEZvb3RlckJ1dHRvbi5yZXBsYWNlKFxuICAgICAgICAgICd7e2J1dHRvbl90ZXh0fX0nLFxuICAgICAgICAgIGJ1dHRvbi50ZXh0LFxuICAgICAgICApO1xuICAgICAgICBtb2RhbEZvb3RlckhUTUwgKz0gbW9kYWxGb290ZXJCdXR0b247XG4gICAgICB9XG4gICAgICBtb2RhbEZvb3RlckhUTUwgPSBtb2RhbEZvb3RlclRlbXBsYXRlLnJlcGxhY2UoXG4gICAgICAgICd7e2J1dHRvbnN9fScsXG4gICAgICAgIG1vZGFsRm9vdGVySFRNTCxcbiAgICAgICk7XG4gICAgfVxuICAgIG1vZGFsSFRNTCA9IG1vZGFsSFRNTC5yZXBsYWNlKCd7e2Zvb3Rlcn19JywgbW9kYWxGb290ZXJIVE1MKTtcbiAgICB0aGlzLmVsZW1Nb2RhbC5pbm5lckhUTUwgPSBtb2RhbEhUTUw7XG4gICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLmVsZW1Nb2RhbCk7XG4gIH1cbiAgc2V0dXBFdmVudExpc3RlbmVycygpIHtcbiAgICB0aGlzLmVsZW1Nb2RhbC5yZW1vdmVFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlckNsb3NlTW9kYWwpO1xuICAgIHRoaXMuaGFuZGxlckNsb3NlTW9kYWxCb3VuZCA9IHRoaXMuaGFuZGxlckNsb3NlTW9kYWwuYmluZCh0aGlzKTtcbiAgICB0aGlzLmVsZW1Nb2RhbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRoaXMuaGFuZGxlckNsb3NlTW9kYWxCb3VuZCk7XG4gIH1cbiAgc2hvdygpIHtcbiAgICBpZiAoIXRoaXMuZGVzdHJveWVkICYmICF0aGlzLmhpZGluZykge1xuICAgICAgdGhpcy5lbGVtTW9kYWwuY2xhc3NMaXN0LmFkZCgnbW9kYWxfX3Nob3cnKTtcbiAgICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQodGhpcy5ldmVudFNob3dNb2RhbCk7XG4gICAgfVxuICB9XG5cbiAgaGlkZSgpIHtcbiAgICB0aGlzLmhpZGluZyA9IHRydWU7XG4gICAgdGhpcy5lbGVtTW9kYWwuY2xhc3NMaXN0LnJlbW92ZSgnbW9kYWxfX3Nob3cnKTtcbiAgICB0aGlzLmVsZW1Nb2RhbC5jbGFzc0xpc3QuYWRkKCdtb2RhbF9faGlkaW5nJyk7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICB0aGlzLmVsZW1Nb2RhbC5jbGFzc0xpc3QucmVtb3ZlKCdtb2RhbF9faGlkaW5nJyk7XG4gICAgICB0aGlzLmhpZGluZyA9IGZhbHNlO1xuICAgIH0sIHRoaXMuYW5pbWF0aW9uU3BlZWQpO1xuICAgIGRvY3VtZW50LmRpc3BhdGNoRXZlbnQodGhpcy5ldmVudEhpZGVNb2RhbCk7XG4gIH1cblxuICBoYW5kbGVyQ2xvc2VNb2RhbChlKSB7XG4gICAgaWYgKGUudGFyZ2V0LmRhdGFzZXQuZGlzbWlzcyA9PT0gJ21vZGFsRnVuYycgfHwgZS50YXJnZXQuZGF0YXNldC5oYW5kbGVyKSB7XG4gICAgICB0aGlzLmhpZGUoKTtcbiAgICB9XG4gIH1cblxuICBkZXN0cm95KCkge1xuICAgIGlmICh0aGlzLmVsZW1Nb2RhbC5wYXJlbnRFbGVtZW50KSB7XG4gICAgICB0aGlzLmVsZW1Nb2RhbC5wYXJlbnRFbGVtZW50LnJlbW92ZUNoaWxkKHRoaXMuZWxlbU1vZGFsKTtcbiAgICB9XG4gICAgaWYgKHRoaXMuaGFuZGxlckNsb3NlTW9kYWxCb3VuZCkge1xuICAgICAgdGhpcy5lbGVtTW9kYWwucmVtb3ZlRXZlbnRMaXN0ZW5lcignY2xpY2snLCB0aGlzLmhhbmRsZXJDbG9zZU1vZGFsQm91bmQpO1xuICAgIH1cbiAgICB0aGlzLmRlc3Ryb3llZCA9IHRydWU7XG4gIH1cblxuICBzZXRDb250ZW50KGh0bWwpIHtcbiAgICB0aGlzLmVsZW1Nb2RhbC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1tb2RhbEZ1bmM9XCJjb250ZW50XCJdJykuaW5uZXJIVE1MID0gaHRtbDtcbiAgfVxuXG4gIHNldFRpdGxlKHRleHQpIHtcbiAgICB0aGlzLmVsZW1Nb2RhbC5xdWVyeVNlbGVjdG9yKCdbZGF0YS1tb2RhbEZ1bmM9XCJ0aXRsZVwiXScpLmlubmVySFRNTCA9IHRleHQ7XG4gIH1cbn1cbiIsImxldCBsYXN0UG9zaXRpb24gPSBudWxsO1xuXG5mdW5jdGlvbiBjcmVhdGVBcnJheVBvc2l0aW9ucyhib2FyZFNpemUpIHtcbiAgY29uc3QgdG90YWxDZWxscyA9IGJvYXJkU2l6ZSAqKiAyO1xuICByZXR1cm4gQXJyYXkuZnJvbSh7IGxlbmd0aDogdG90YWxDZWxscyAvIDggfSwgKF8sIGkpID0+IGkgKiA4KS5mbGF0TWFwKFxuICAgIChjZWxsKSA9PiBbY2VsbCwgY2VsbCArIDFdLFxuICApO1xufVxuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBjcmVhdGVQb3NpdGlvbihib2FyZFNpemUpIHtcbiAgY29uc3QgY2VsbHMgPSBjcmVhdGVBcnJheVBvc2l0aW9ucyhib2FyZFNpemUpO1xuICBsZXQgcmFuZDtcblxuICBkbyB7XG4gICAgcmFuZCA9IE1hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNlbGxzLmxlbmd0aCk7XG4gIH0gd2hpbGUgKGNlbGxzW3JhbmRdID09PSBsYXN0UG9zaXRpb24pO1xuXG4gIGxhc3RQb3NpdGlvbiA9IGNlbGxzW3JhbmRdO1xuICByZXR1cm4gbGFzdFBvc2l0aW9uO1xufVxuIiwiaW1wb3J0IGhhbW1lckltZyBmcm9tICcuLi9pbWcvaGFtbWVyX3NtYWxsLnBuZyc7XG5cbmNvbnN0IGN1cnNvcnMgPSB7XG4gIHBvaW50ZXI6ICdwb2ludGVyJyxcbiAgbm90YWxsb3dlZDogJ25vdC1hbGxvd2VkJyxcbiAgaGFtbWVyOiBgdXJsKCcke2hhbW1lckltZ30nKSwgbm90LWFsbG93ZWRgLFxufTtcblxuZXhwb3J0IGRlZmF1bHQgY3Vyc29ycztcbiIsImltcG9ydCAnLi9jbGljay1jb3VudGVyLmNzcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIENsaWNrQ291bnRlciB7XG4gIGNvbnN0cnVjdG9yKGNvbnRhaW5lcikge1xuICAgIHRoaXMuaGl0Q291bnQgPSAwO1xuICAgIHRoaXMubWlzc0NvdW50ID0gMDtcbiAgICB0aGlzLmNvbnRhaW5lciA9IGNvbnRhaW5lcjtcblxuICAgIHRoaXMuaW5pdFVJKCk7XG4gIH1cblxuICBpbml0VUkoKSB7XG4gICAgaWYgKCEodGhpcy5jb250YWluZXIgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignY29udGFpbmVyIGlzIG5vdCBIVE1MRWxlbWVudCcpO1xuICAgIH1cblxuICAgIHRoaXMuY29udGFpbmVyLmluc2VydEFkamFjZW50SFRNTChcbiAgICAgICdhZnRlcmJlZ2luJyxcbiAgICAgIGBcbiAgICA8ZGl2IGNsYXNzPVwiY2xpY2stY291bnRlclwiPlxuICAgICAgICA8ZGl2PkhpdCBjb3VudHM6IDxzcGFuIGNsYXNzPVwiaGl0LWNvdW50XCI+JHt0aGlzLmdldEhpdENvdW50KCl9PC9zcGFuPjwvZGl2PlxuICAgICAgICA8ZGl2Pk1pc3MgY291bnRzOiA8c3BhbiBjbGFzcz1cIm1pc3MtY291bnRcIj4ke3RoaXMuZ2V0TWlzc0NvdW50KCl9PC9zcGFuPjwvZGl2PlxuICAgIDwvZGl2PlxuICAgIGAsXG4gICAgKTtcbiAgICB0aGlzLmhpdENvdW50RWwgPSB0aGlzLmNvbnRhaW5lci5xdWVyeVNlbGVjdG9yKCcuaGl0LWNvdW50Jyk7XG4gICAgdGhpcy5taXNzQ291bnRFbCA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJy5taXNzLWNvdW50Jyk7XG4gIH1cblxuICBpbmNyZW1lbnRIaXQoKSB7XG4gICAgdGhpcy5oaXRDb3VudCArPSAxO1xuICAgIHRoaXMudXBkYXRlVUkoKTtcbiAgfVxuXG4gIGluY3JlbWVudE1pc3MoKSB7XG4gICAgdGhpcy5taXNzQ291bnQgKz0gMTtcbiAgICB0aGlzLnVwZGF0ZVVJKCk7XG4gIH1cblxuICB1cGRhdGVVSSgpIHtcbiAgICB0aGlzLmhpdENvdW50RWwudGV4dENvbnRlbnQgPSB0aGlzLmdldEhpdENvdW50KCk7XG4gICAgdGhpcy5taXNzQ291bnRFbC50ZXh0Q29udGVudCA9IHRoaXMuZ2V0TWlzc0NvdW50KCk7XG4gIH1cblxuICBnZXRIaXRDb3VudCgpIHtcbiAgICByZXR1cm4gdGhpcy5oaXRDb3VudDtcbiAgfVxuXG4gIGdldE1pc3NDb3VudCgpIHtcbiAgICByZXR1cm4gdGhpcy5taXNzQ291bnQ7XG4gIH1cblxuICByZXNldCgpIHtcbiAgICB0aGlzLm1pc3NDb3VudCA9IDA7XG4gICAgdGhpcy5oaXRDb3VudCA9IDA7XG4gICAgdGhpcy51cGRhdGVVSSgpO1xuICB9XG59XG4iLCJpbXBvcnQgR2FtZVBsYXkgZnJvbSAnLi9jb21wb25lbnRzL0dhbWVQbGF5L0dhbWVQbGF5JztcbmltcG9ydCBHYW1lQ29udHJvbGxlciBmcm9tICcuL2NvbXBvbmVudHMvR2FtZUNvbnRyb2xsZXIvR2FtZUNvbnRyb2xsZXInO1xuXG4vKiBlc2xpbnQtZGlzYWJsZSAqL1xuY29uc29sZS5sb2coJ2l0IHdvcmtzIScpO1xuXG5jb25zdCBnYW1lUGxheSA9IG5ldyBHYW1lUGxheSg0KTtcbmdhbWVQbGF5LmJpbmRUb0RPTShkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2FtZS1jb250YWluZXInKSk7XG5cbmNvbnN0IGdhbWVDdHJsID0gbmV3IEdhbWVDb250cm9sbGVyKGdhbWVQbGF5KTtcbmdhbWVDdHJsLmluaXQoKTsiLCJpbXBvcnQgY2FsY1RpbGVUeXBlIGZyb20gJy4uLy4uL3V0aWxzL2NhbGNUaWxlVHlwZSc7XG5pbXBvcnQgTW9kYWwgZnJvbSAnLi4vTW9kYWwvTW9kYWwnO1xuXG5pbXBvcnQgJy4vZ2FtZS1wbGF5LmNzcyc7XG5cbmV4cG9ydCBkZWZhdWx0IGNsYXNzIEdhbWVQbGF5IHtcbiAgY29uc3RydWN0b3IoYm9hcmRTaXplKSB7XG4gICAgdGhpcy5ib2FyZFNpemUgPSBib2FyZFNpemU7XG4gICAgdGhpcy5jb250YWluZXIgPSBudWxsO1xuICAgIHRoaXMuYm9hcmRFbCA9IG51bGw7XG4gICAgdGhpcy5jZWxscyA9IFtdO1xuICAgIHRoaXMuY2VsbENsaWNrTGlzdGVuZXJzID0gW107XG4gICAgdGhpcy5jZWxsRW50ZXJMaXN0ZW5lcnMgPSBbXTtcbiAgICB0aGlzLmNlbGxMZWF2ZUxpc3RlbmVycyA9IFtdO1xuICAgIHRoaXMuaXNNb2RhbCA9IGZhbHNlO1xuXG4gICAgdGhpcy5pbml0TW9kYWxMaXN0ZW5lcigpO1xuICB9XG5cbiAgYmluZFRvRE9NKGNvbnRhaW5lcikge1xuICAgIGlmICghKGNvbnRhaW5lciBpbnN0YW5jZW9mIEhUTUxFbGVtZW50KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdjb250YWluZXIgaXMgbm90IEhUTUxFbGVtZW50Jyk7XG4gICAgfVxuICAgIHRoaXMuY29udGFpbmVyID0gY29udGFpbmVyO1xuICB9XG5cbiAgaW5pdE1vZGFsTGlzdGVuZXIoKSB7XG4gICAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZSkgPT4ge1xuICAgICAgaWYgKFxuICAgICAgICBlLnRhcmdldC5kYXRhc2V0LmhhbmRsZXIgPT09ICdtb2RhbEhhbmRsZXJDYW5jZWwnXG4gICAgICAgICYmIHRoaXMuY3VycmVudE1vZGFsXG4gICAgICApIHtcbiAgICAgICAgdGhpcy5jdXJyZW50TW9kYWwuaGlkZSgpO1xuICAgICAgICB0aGlzLmlzTW9kYWwgPSBmYWxzZTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIGRyYXdVaSh0aGVtZSkge1xuICAgIHRoaXMuY2hlY2tCaW5kaW5nKCk7XG5cbiAgICB0aGlzLmNvbnRhaW5lci5pbm5lckhUTUwgPSBgXG4gICAgICA8ZGl2IGNsYXNzPVwiYm9hcmQtY29udGFpbmVyXCI+XG4gICAgICAgIDxkaXYgZGF0YS1pZD1cImJvYXJkXCIgY2xhc3M9XCJib2FyZFwiPjwvZGl2PlxuICAgICAgPC9kaXY+XG4gICAgYDtcblxuICAgIHRoaXMuYm9hcmRFbCA9IHRoaXMuY29udGFpbmVyLnF1ZXJ5U2VsZWN0b3IoJ1tkYXRhLWlkPWJvYXJkXScpO1xuXG4gICAgdGhpcy5ib2FyZEVsLmNsYXNzTGlzdC5hZGQodGhlbWUpO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgdGhpcy5ib2FyZFNpemUgKiogMjsgaSArPSAxKSB7XG4gICAgICBjb25zdCBjZWxsRWwgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgIGNlbGxFbC5jbGFzc0xpc3QuYWRkKFxuICAgICAgICAnY2VsbCcsXG4gICAgICAgICdtYXAtdGlsZScsXG4gICAgICAgIGBtYXAtdGlsZS0ke2NhbGNUaWxlVHlwZShpLCB0aGlzLmJvYXJkU2l6ZSl9YCxcbiAgICAgICk7XG4gICAgICBjZWxsRWwuYWRkRXZlbnRMaXN0ZW5lcignbW91c2VlbnRlcicsIChldmVudCkgPT4gdGhpcy5vbkNlbGxFbnRlcihldmVudCkpO1xuICAgICAgY2VsbEVsLmFkZEV2ZW50TGlzdGVuZXIoJ21vdXNlbGVhdmUnLCAoZXZlbnQpID0+IHRoaXMub25DZWxsTGVhdmUoZXZlbnQpKTtcbiAgICAgIGNlbGxFbC5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIChldmVudCkgPT4gdGhpcy5vbkNlbGxDbGljayhldmVudCkpO1xuICAgICAgdGhpcy5ib2FyZEVsLmFwcGVuZENoaWxkKGNlbGxFbCk7XG4gICAgfVxuXG4gICAgdGhpcy5jZWxscyA9IEFycmF5LmZyb20odGhpcy5ib2FyZEVsLmNoaWxkcmVuKTtcbiAgfVxuXG4gIHJlZHJhd1Bvc2l0aW9ucyhwb3NpdGlvbikge1xuICAgIGZvciAoY29uc3QgY2VsbCBvZiB0aGlzLmNlbGxzKSB7XG4gICAgICBjZWxsLmlubmVySFRNTCA9ICcnO1xuICAgIH1cbiAgICBpZiAocG9zaXRpb24gIT09IHVuZGVmaW5lZCAmJiBwb3NpdGlvbiA+PSAwICYmIHBvc2l0aW9uIDwgdGhpcy5jZWxscy5sZW5ndGgpIHtcbiAgICBjb25zdCBjZWxsRWwgPSB0aGlzLmJvYXJkRWwuY2hpbGRyZW5bcG9zaXRpb25dO1xuICAgIGNvbnN0IGNoYXJFbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuICAgIGNoYXJFbC5jbGFzc0xpc3QuYWRkKCdjaGFyYWN0ZXInLCAnZ2VuZXJpYycpO1xuXG4gICAgY2VsbEVsLmFwcGVuZENoaWxkKGNoYXJFbCk7XG4gICAgfVxuICB9XG5cbiAgYWRkQ2VsbEVudGVyTGlzdGVuZXIoY2FsbGJhY2spIHtcbiAgICB0aGlzLmNlbGxFbnRlckxpc3RlbmVycy5wdXNoKGNhbGxiYWNrKTtcbiAgfVxuXG4gIGFkZENlbGxMZWF2ZUxpc3RlbmVyKGNhbGxiYWNrKSB7XG4gICAgdGhpcy5jZWxsTGVhdmVMaXN0ZW5lcnMucHVzaChjYWxsYmFjayk7XG4gIH1cblxuICBhZGRDZWxsQ2xpY2tMaXN0ZW5lcihjYWxsYmFjaykge1xuICAgIHRoaXMuY2VsbENsaWNrTGlzdGVuZXJzLnB1c2goY2FsbGJhY2spO1xuICB9XG5cbiAgb25DZWxsRW50ZXIoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jZWxscy5pbmRleE9mKGV2ZW50LmN1cnJlbnRUYXJnZXQpO1xuICAgIHRoaXMuY2VsbEVudGVyTGlzdGVuZXJzLmZvckVhY2goKG8pID0+IG8uY2FsbChudWxsLCBpbmRleCkpO1xuICB9XG5cbiAgb25DZWxsTGVhdmUoZXZlbnQpIHtcbiAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIGNvbnN0IGluZGV4ID0gdGhpcy5jZWxscy5pbmRleE9mKGV2ZW50LmN1cnJlbnRUYXJnZXQpO1xuICAgIHRoaXMuY2VsbExlYXZlTGlzdGVuZXJzLmZvckVhY2goKG8pID0+IG8uY2FsbChudWxsLCBpbmRleCkpO1xuICB9XG5cbiAgb25DZWxsQ2xpY2soZXZlbnQpIHtcbiAgICBjb25zdCBpbmRleCA9IHRoaXMuY2VsbHMuaW5kZXhPZihldmVudC5jdXJyZW50VGFyZ2V0KTtcbiAgICB0aGlzLmNlbGxDbGlja0xpc3RlbmVycy5mb3JFYWNoKChvKSA9PiBvLmNhbGwobnVsbCwgaW5kZXgpKTtcbiAgfVxuXG4gIHNlbGVjdENlbGwoaW5kZXgsIGNvbG9yID0gJ3llbGxvdycpIHtcbiAgICB0aGlzLmRlc2VsZWN0Q2VsbChpbmRleCk7XG4gICAgdGhpcy5jZWxsc1tpbmRleF0uY2xhc3NMaXN0LmFkZCgnc2VsZWN0ZWQnLCBgc2VsZWN0ZWQtJHtjb2xvcn1gKTtcbiAgfVxuXG4gIGRlc2VsZWN0Q2VsbChpbmRleCkge1xuICAgIGNvbnN0IGNlbGwgPSB0aGlzLmNlbGxzW2luZGV4XTtcbiAgICBjZWxsLmNsYXNzTGlzdC5yZW1vdmUoXG4gICAgICAuLi5BcnJheS5mcm9tKGNlbGwuY2xhc3NMaXN0KS5maWx0ZXIoKG8pID0+IG8uc3RhcnRzV2l0aCgnc2VsZWN0ZWQnKSksXG4gICAgKTtcbiAgfVxuXG4gIGhpZGVDZWxsVG9vbHRpcChpbmRleCkge1xuICAgIHRoaXMuY2VsbHNbaW5kZXhdLnRpdGxlID0gJyc7XG4gIH1cblxuICBzZXRDdXJzb3IoY3Vyc29yKSB7XG4gICAgdGhpcy5ib2FyZEVsLnN0eWxlLmN1cnNvciA9IGN1cnNvcjtcbiAgfVxuXG4gIGNoZWNrQmluZGluZygpIHtcbiAgICBpZiAodGhpcy5jb250YWluZXIgPT09IG51bGwpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcignR2FtZVBsYXkgbm90IGJpbmQgdG8gRE9NJyk7XG4gICAgfVxuICB9XG5cbiAgc2hvd01vZGFsTWVzc2FnZShtZXNzYWdlLCB1bmljb2RlKSB7XG4gICAgaWYgKCF0aGlzLmlzTW9kYWwpIHtcbiAgICAgIHRoaXMuaXNNb2RhbCA9IHRydWU7XG4gICAgICB0aGlzLnNob3dNb2RhbChtZXNzYWdlLCB1bmljb2RlKTtcbiAgICB9XG4gIH1cblxuICBzaG93TW9kYWwobWVzc2FnZSwgdW5pY29kZSkge1xuICAgIGNvbnN0IG1vZGFsID0gbmV3IE1vZGFsKHtcbiAgICAgIHRpdGxlOiBtZXNzYWdlLFxuICAgICAgY29udGVudDogYCYjJHt1bmljb2RlfWAsXG4gICAgICBmb290ZXJCdXR0b25zOiBbXG4gICAgICAgIHtcbiAgICAgICAgICBjbGFzczogJ2J0biBidG5fX2NhbmNlbCcsXG4gICAgICAgICAgdGV4dDogJ0Nsb3NlJyxcbiAgICAgICAgICBoYW5kbGVyOiAnbW9kYWxIYW5kbGVyQ2FuY2VsJyxcbiAgICAgICAgfSxcbiAgICAgIF0sXG4gICAgfSk7XG5cbiAgICB0aGlzLmN1cnJlbnRNb2RhbCA9IG1vZGFsO1xuXG4gICAgbW9kYWwuc2hvdygpO1xuICB9XG59XG4iLCJpbXBvcnQgY3JlYXRlUG9zaXRpb24gZnJvbSAnLi4vLi4vdXRpbHMvY3JlYXRlUG9zaXRpb24nO1xuaW1wb3J0IGN1cnNvcnMgZnJvbSAnLi4vLi4vY3Vyc29ycyc7XG5pbXBvcnQgQ2xpY2tDb3VudGVyIGZyb20gJy4uL0NsaWNrQ291bnRlci9DbGlja0NvdW50ZXInO1xuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBHYW1lQ29udHJvbGxlciB7XG4gIGNvbnN0cnVjdG9yKGdhbWVQbGF5KSB7XG4gICAgdGhpcy5nYW1lUGxheSA9IGdhbWVQbGF5O1xuICAgIHRoaXMuaW5kZXhTZWxlY3QgPSBudWxsO1xuICAgIHRoaXMuY2xpY2tDb3VudGVyID0gbnVsbDtcbiAgICB0aGlzLm9uQ2VsbENsaWNrID0gdGhpcy5vbkNlbGxDbGljay5iaW5kKHRoaXMpO1xuICAgIHRoaXMub25DZWxsRW50ZXIgPSB0aGlzLm9uQ2VsbEVudGVyLmJpbmQodGhpcyk7XG4gICAgdGhpcy5vbkNlbGxMZWF2ZSA9IHRoaXMub25DZWxsTGVhdmUuYmluZCh0aGlzKTtcbiAgfVxuXG4gIGluaXQoKSB7XG4gICAgdGhpcy5ldmVudHMoKTtcbiAgICB0aGlzLmdhbWVQbGF5LmRyYXdVaSgncHJhaXJpZScpO1xuICAgIHRoaXMuY2xpY2tDb3VudGVyID0gbmV3IENsaWNrQ291bnRlcihkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjZ2FtZS1jb250YWluZXInKSk7XG4gICAgdGhpcy5zaG93Q2hhcmFjdGVyKCk7XG4gIH1cblxuICBldmVudHMoKSB7XG4gICAgdGhpcy5nYW1lUGxheS5hZGRDZWxsRW50ZXJMaXN0ZW5lcih0aGlzLm9uQ2VsbEVudGVyKTtcbiAgICB0aGlzLmdhbWVQbGF5LmFkZENlbGxMZWF2ZUxpc3RlbmVyKHRoaXMub25DZWxsTGVhdmUpO1xuICAgIHRoaXMuZ2FtZVBsYXkuYWRkQ2VsbENsaWNrTGlzdGVuZXIodGhpcy5vbkNlbGxDbGljayk7XG4gIH1cblxuICBvbkNlbGxDbGljayhlKSB7XG4gICAgdGhpcy5yZWFjdE9uQ2xpY2soZSk7XG4gIH1cblxuICBvbkNlbGxFbnRlcihpbmRleCkge1xuICAgIHRoaXMuZ2FtZVBsYXkuc2V0Q3Vyc29yKGN1cnNvcnMuaGFtbWVyKTtcblxuICAgIGlmIChkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuc2VsZWN0ZWQtZ2VuZXJpYycpKSB7XG4gICAgICB0aGlzLmdhbWVQbGF5LmRlc2VsZWN0Q2VsbCh0aGlzLmluZGV4U2VsZWN0KTtcbiAgICB9XG5cbiAgICB0aGlzLmdhbWVQbGF5LnNlbGVjdENlbGwoaW5kZXgpO1xuICAgIHRoaXMuaW5kZXhTZWxlY3QgPSBpbmRleDtcbiAgfVxuXG4gIG9uQ2VsbExlYXZlKGluZGV4KSB7XG4gICAgdGhpcy5nYW1lUGxheS5oaWRlQ2VsbFRvb2x0aXAoaW5kZXgpO1xuICAgIHRoaXMuZ2FtZVBsYXkuc2V0Q3Vyc29yKGN1cnNvcnMucG9pbnRlcik7XG4gIH1cblxuICBzaG93Q2hhcmFjdGVyKCkge1xuICAgIHRoaXMudGltZXJJZCA9IHNldEludGVydmFsKCgpID0+IHtcbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gY3JlYXRlUG9zaXRpb24odGhpcy5nYW1lUGxheS5ib2FyZFNpemUpO1xuICAgICAgdGhpcy5nYW1lUGxheS5yZWRyYXdQb3NpdGlvbnMocG9zaXRpb24pO1xuICAgIH0sIDEwMDApO1xuXG4gICAgc2V0VGltZW91dCgoKSA9PiB0aGlzLnJlc2V0VGltZXIoKSwgNTAwMDAwKTtcbiAgfVxuXG4gIHJlc2V0VGltZXIoKSB7XG4gICAgY2xlYXJJbnRlcnZhbCh0aGlzLnRpbWVySWQpO1xuICB9XG5cbiAgcmVhY3RPbkNsaWNrKGUpIHtcbiAgICBjb25zdCBib2FyZENlbGxDbGljayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5jZWxsJylbZV07XG4gICAgY29uc3QgaXNHb2JsaW4gPSBib2FyZENlbGxDbGljay5xdWVyeVNlbGVjdG9yKCcuZ2VuZXJpYycpO1xuXG4gICAgaWYgKGlzR29ibGluKSB7XG4gICAgICB0aGlzLmNsaWNrQ291bnRlci5pbmNyZW1lbnRIaXQoKTtcbiAgICAgIHRoaXMucmVzZXRUaW1lcigpOyAvLyBmaXgg0YHQsdGA0LDRgdGL0LLQsNC10Lwg0LjQvdGC0LXRgNCy0LDQu1xuICAgICAgdGhpcy5zaG93Q2hhcmFjdGVyKCk7IC8vIGZpeCDQv9C10YDQtdC30LDQv9GD0YHQutCw0LXQvCDQuNC90YLQtdGA0LLQsNC7XG5cbiAgICAgIGNvbnN0IHBvc2l0aW9uID0gY3JlYXRlUG9zaXRpb24odGhpcy5nYW1lUGxheS5ib2FyZFNpemUpO1xuICAgICAgdGhpcy5nYW1lUGxheS5yZWRyYXdQb3NpdGlvbnMocG9zaXRpb24pO1xuXG4gICAgICBpZiAodGhpcy5jbGlja0NvdW50ZXIuZ2V0SGl0Q291bnQoKSA+PSAxMCkge1xuICAgICAgICB0aGlzLmdhbWVQbGF5LnNob3dNb2RhbE1lc3NhZ2UoYFlvdSB3aW4hIFlvdXIgcG9pbnRzIGFyZSAke3RoaXMuY2xpY2tDb3VudGVyLmdldEhpdENvdW50KCl9YCwgJzEyNzg4MScpO1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2xpY2tDb3VudGVyLmluY3JlbWVudE1pc3MoKTtcbiAgICAgIGlmICh0aGlzLmNsaWNrQ291bnRlci5nZXRNaXNzQ291bnQoKSA+PSA1KSB7XG4gICAgICAgIHRoaXMuZ2FtZVBsYXkuc2hvd01vZGFsTWVzc2FnZSgnWW91IGxvc2UhJywgJzEyOTMzNScpO1xuICAgICAgICB0aGlzLnJlc2V0KCk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmVzZXQoKSB7XG4gICAgdGhpcy5jbGlja0NvdW50ZXIucmVzZXQoKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbIl9fd2VicGFja19yZXF1aXJlX18iLCJjYWxjVGlsZVR5cGUiLCJpbmRleCIsImJvYXJkU2l6ZSIsImlzVG9wUm93IiwiaXNCb3R0b21Sb3ciLCJpc0xlZnRDb2x1bW4iLCJpc1JpZ2h0Q29sdW1uIiwiZyIsImdsb2JhbFRoaXMiLCJ0aGlzIiwiRnVuY3Rpb24iLCJlIiwid2luZG93Iiwic2NyaXB0VXJsIiwiaW1wb3J0U2NyaXB0cyIsImxvY2F0aW9uIiwiZG9jdW1lbnQiLCJjdXJyZW50U2NyaXB0Iiwic3JjIiwic2NyaXB0cyIsImdldEVsZW1lbnRzQnlUYWdOYW1lIiwibGVuZ3RoIiwiRXJyb3IiLCJyZXBsYWNlIiwicCIsIk1vZGFsIiwiY29uc3RydWN0b3IiLCJvcHRpb25zIiwiZWxlbU1vZGFsIiwiZXZlbnRTaG93TW9kYWwiLCJldmVudEhpZGVNb2RhbCIsImhpZGluZyIsImRlc3Ryb3llZCIsImFuaW1hdGlvblNwZWVkIiwiY3JlYXRlTW9kYWwiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlckNsb3NlTW9kYWwiLCJiaW5kIiwiQ3VzdG9tRXZlbnQiLCJkZXRhaWwiLCJjcmVhdGVFbGVtZW50IiwibW9kYWxIVE1MIiwibW9kYWxGb290ZXJIVE1MIiwiY2xhc3NMaXN0IiwiYWRkIiwidGl0bGUiLCJjb250ZW50IiwiZm9vdGVyQnV0dG9ucyIsImJ1dHRvbiIsIm1vZGFsRm9vdGVyQnV0dG9uIiwiY2xhc3MiLCJoYW5kbGVyIiwidGV4dCIsImlubmVySFRNTCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsInNldHVwRXZlbnRMaXN0ZW5lcnMiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiaGFuZGxlckNsb3NlTW9kYWxCb3VuZCIsInNob3ciLCJkaXNwYXRjaEV2ZW50IiwiaGlkZSIsInJlbW92ZSIsInNldFRpbWVvdXQiLCJ0YXJnZXQiLCJkYXRhc2V0IiwiZGlzbWlzcyIsImRlc3Ryb3kiLCJwYXJlbnRFbGVtZW50IiwicmVtb3ZlQ2hpbGQiLCJzZXRDb250ZW50IiwiaHRtbCIsInF1ZXJ5U2VsZWN0b3IiLCJzZXRUaXRsZSIsImxhc3RQb3NpdGlvbiIsImNyZWF0ZVBvc2l0aW9uIiwiY2VsbHMiLCJ0b3RhbENlbGxzIiwiQXJyYXkiLCJmcm9tIiwiXyIsImkiLCJmbGF0TWFwIiwiY2VsbCIsImNyZWF0ZUFycmF5UG9zaXRpb25zIiwicmFuZCIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsInBvaW50ZXIiLCJub3RhbGxvd2VkIiwiaGFtbWVyIiwiQ2xpY2tDb3VudGVyIiwiY29udGFpbmVyIiwiaGl0Q291bnQiLCJtaXNzQ291bnQiLCJpbml0VUkiLCJIVE1MRWxlbWVudCIsImluc2VydEFkamFjZW50SFRNTCIsImdldEhpdENvdW50IiwiZ2V0TWlzc0NvdW50IiwiaGl0Q291bnRFbCIsIm1pc3NDb3VudEVsIiwiaW5jcmVtZW50SGl0IiwidXBkYXRlVUkiLCJpbmNyZW1lbnRNaXNzIiwidGV4dENvbnRlbnQiLCJyZXNldCIsImNvbnNvbGUiLCJsb2ciLCJnYW1lUGxheSIsImJvYXJkRWwiLCJjZWxsQ2xpY2tMaXN0ZW5lcnMiLCJjZWxsRW50ZXJMaXN0ZW5lcnMiLCJjZWxsTGVhdmVMaXN0ZW5lcnMiLCJpc01vZGFsIiwiaW5pdE1vZGFsTGlzdGVuZXIiLCJiaW5kVG9ET00iLCJjdXJyZW50TW9kYWwiLCJkcmF3VWkiLCJ0aGVtZSIsImNoZWNrQmluZGluZyIsImNlbGxFbCIsImV2ZW50Iiwib25DZWxsRW50ZXIiLCJvbkNlbGxMZWF2ZSIsIm9uQ2VsbENsaWNrIiwiY2hpbGRyZW4iLCJyZWRyYXdQb3NpdGlvbnMiLCJwb3NpdGlvbiIsInVuZGVmaW5lZCIsImNoYXJFbCIsImFkZENlbGxFbnRlckxpc3RlbmVyIiwiY2FsbGJhY2siLCJwdXNoIiwiYWRkQ2VsbExlYXZlTGlzdGVuZXIiLCJhZGRDZWxsQ2xpY2tMaXN0ZW5lciIsInByZXZlbnREZWZhdWx0IiwiaW5kZXhPZiIsImN1cnJlbnRUYXJnZXQiLCJmb3JFYWNoIiwibyIsImNhbGwiLCJzZWxlY3RDZWxsIiwiY29sb3IiLCJhcmd1bWVudHMiLCJkZXNlbGVjdENlbGwiLCJmaWx0ZXIiLCJzdGFydHNXaXRoIiwiaGlkZUNlbGxUb29sdGlwIiwic2V0Q3Vyc29yIiwiY3Vyc29yIiwic3R5bGUiLCJzaG93TW9kYWxNZXNzYWdlIiwibWVzc2FnZSIsInVuaWNvZGUiLCJzaG93TW9kYWwiLCJtb2RhbCIsImdhbWVDdHJsIiwiaW5kZXhTZWxlY3QiLCJjbGlja0NvdW50ZXIiLCJpbml0IiwiZXZlbnRzIiwic2hvd0NoYXJhY3RlciIsInJlYWN0T25DbGljayIsImN1cnNvcnMiLCJ0aW1lcklkIiwic2V0SW50ZXJ2YWwiLCJyZXNldFRpbWVyIiwiY2xlYXJJbnRlcnZhbCIsInF1ZXJ5U2VsZWN0b3JBbGwiXSwic291cmNlUm9vdCI6IiJ9